<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <!-- A-Frame itself -->
<script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

<!-- Pure three.js code that the A-Frame components use for location-based AR -->
<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.7/three.js/build/ar-threex-location-only.js'></script>

<!-- AR.js A-Frame components -->
<script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js'></script>

    <style>
      /* Infofenster unten */
      #info-box {
        position: fixed;       /* fixiert am Bildschirm, nicht in der AR-Szene */
        bottom: 0;             /* am unteren Rand */
        left: 0;
        width: 100%;           /* volle Breite */
        background: rgba(221,221,221,0.7); /* hellgrau mit Transparenz */
        color: #000;                       /* schwarze Schrift */
        font-family: sans-serif;
        font-size: 14px;
        padding: 10px;
        box-sizing: border-box;
        text-align: left; 
      }
    </style>
        
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            renderer="logarithmicDepthBuffer: true;"
            embedded
            loading-screen="enabled: false;"
            arjs="sourceType: webcam; gpsMinDistance: 2; debugUIEnabled: false;"
        >
            <a-assets>
                <a-asset-item id="animated-asset" src="assets/gameobjectohnekellerreduziert.glb"></a-asset-item>
            </a-assets>
<!--device-orientation-permission-ui="enabled: true"-->
<a-entity id="world-yaw" rotation="0 0 0">
     <a-entity gps-entity-place="latitude: 47.866871150; longitude: 12.109124974;">
		<!-- <a-entity gps-entity-place="latitude: 47.867615758; longitude: 12.109218307;"> -->
		 	<a-entity gltf-model="#animated-asset" scale="0.8 0.8 0.8" position="-20 -4 0">
			</a-entity>
      </a-entity>
</a-entity>

<a-camera
        gps-camera="simulateLatitude:  47.866880722; simulateLongitude: 12.109128178;"
        rotation-reader>
      </a-camera>
    <!--        
    <a-camera gps-camera="minAccuracy: 50" rotation-reader></a-camera>
            -->
        </a-scene>
<!--
<script>
  (function () {
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    if (!isIOS) return;
    const world = document.getElementById('world-yaw');
    if (!world) return;
    // Falls es â€žin die andere Richtungâ€œ ist, -90 verwenden.
    world.setAttribute('rotation', '0 90 0');
  })();
</script>

		<script>
  (function () {
    const isIOS =
      /iPad|iPhone|iPod/.test(navigator.userAgent) ||
      (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    if (!isIOS) return;

    const world = document.getElementById('world-yaw');
    if (!world) return;

    function applyOrientationFix() {
      // PrÃ¼fe aktuelle Bildschirmausrichtung
      const angle =
        (screen.orientation && typeof screen.orientation.angle === 'number')
          ? screen.orientation.angle
          : (typeof window.orientation === 'number'
              ? window.orientation
              : 0);

      // Standard: keine Drehung
      let yawFix = 0;

      // Landscape-Modus erkannt â†’ 90Â°-Korrektur
      if (Math.abs(angle) === 90) yawFix = 90;

      world.setAttribute('rotation', `0 ${yawFix} 0`);
      console.log('Orientation:', angle, 'â†’ world rotation:', yawFix);
    }

    // Einmal beim Laden anwenden â€¦
    applyOrientationFix();
    // â€¦ und erneut, wenn das GerÃ¤t gedreht wird
    window.addEventListener('orientationchange', applyOrientationFix);
  })();
</script>
				-->
<script>
  (function () {
    const isIOS =
      /iPad|iPhone|iPod/.test(navigator.userAgent) ||
      (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    if (!isIOS) return;

    const world = document.getElementById('world-yaw');
    if (!world) return;

    // ðŸ‘‰ Hier pro Orientierung den gewÃ¼nschten Yaw-Offset (in Grad) eintragen.
    //    Falls etwas â€žfalsch herumâ€œ ist, Vorzeichen tauschen.
    const OFFSETS = {
      'portrait-primary':   0,   // GerÃ¤t hochkant, Standardausrichtung (Top-Knopf oben)
      'portrait-secondary': 180,   // GerÃ¤t hochkant, auf dem Kopf
      'landscape-primary':  90,  // GerÃ¤t quer, â€žersteâ€œ Landscape-Seite
      'landscape-secondary':-90  // GerÃ¤t quer, andere Landscape-Seite
    };

    function getScreenAngle() {
      if (screen.orientation && typeof screen.orientation.angle === 'number') {
        return screen.orientation.angle; // 0, 90, 180, 270
      }
      if (typeof window.orientation === 'number') {
        // iOS Safari: 0, 90, -90, 180
        return window.orientation;
      }
      // Fallback: Portrait annehmen
      return 0;
    }

    function normalizeAngle(a) {
      // Normiere auf -180..180
      a = ((a % 360) + 360) % 360;
      if (a > 180) a -= 360;
      return a;
    }

    function getOrientationType() {
      // Wenn verfÃ¼gbar, direkt nehmen (am prÃ¤zisesten)
      if (screen.orientation && screen.orientation.type) {
        return screen.orientation.type; // z.B. 'portrait-primary'
      }

      // iOS: aus Winkel ableiten
      const ang = normalizeAngle(getScreenAngle());
      // Konvention:
      //   0    -> portrait-primary
      //   180  -> portrait-secondary
      //   90   -> landscape-primary
      //   -90  -> landscape-secondary
      if (ang === 0)   return 'portrait-primary';
      if (ang === 180 || ang === -180) return 'portrait-secondary';
      if (ang === 90)  return 'landscape-primary';
      if (ang === -90) return 'landscape-secondary';

      // Fallback
      return 'portrait-primary';
    }

    function applyOrientationFix() {
      const type = getOrientationType();
      const yawFix = OFFSETS[type] ?? 0;
      world.setAttribute('rotation', `0 ${yawFix} 0`);
      // optional: debug
      // console.log('orientation:', type, 'â†’ yawFix:', yawFix);
    }

    // Beim Start anwenden â€¦
    applyOrientationFix();
    // â€¦ und bei Drehung erneut
    window.addEventListener('orientationchange', applyOrientationFix);

    // iOS 17+ feuert manchmal kein orientationchange bei kleinen Kippbewegungen:
    // Als Backup reagiert zusÃ¤tzlich auf Resize (hat kaum Overhead).
    // window.addEventListener('resize', applyOrientationFix);
  })();
</script>

			<div id="info-box"> 
              Version: 4.5
          </div>
        
    </body>
</html>
