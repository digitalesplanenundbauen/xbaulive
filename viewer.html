<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>GLB Viewer – A-Frame (ganze Seite)</title>
  <!-- A-Frame (stabil, unabhängig) -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <style>
    html, body { height:100%; margin:0; }
    a-scene    { width:100%; height:100%; touch-action:none; background:#ffffff; }
  </style>
</head>
<body>
  <a-scene>
    <a-assets>
      <!-- DEIN GLB: Pfad/URL anpassen -->
      <a-asset-item id="m" src="assets/gameobjectohnekellerreduziert.glb" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
    </a-assets>

    <!-- Beleuchtung (einfach & neutral) -->
    <a-entity light="type: ambient; intensity: 0.9"></a-entity>
    <a-entity light="type: directional; intensity: 1.0" position="1 2 1"></a-entity>

    <!-- Modell (dieses Entity drehen wir interaktiv) -->
    <a-entity id="model" gltf-model="#m" position="0 0 0" rotation="0 0 0" scale="1 1 1"></a-entity>

    <!-- Kamera (Zoom = Z-Position) -->
    <a-entity id="cam" camera position="0 1.6 6" look-controls="enabled:false" wasd-controls="enabled:false"></a-entity>
  </a-scene>

  <script>
    const scene = document.querySelector('a-scene');
    const model = document.getElementById('model');
    const cam   = document.getElementById('cam');

    // Tuning
    const rotSpeed = 0.3;            // Grad pro Pixel
    const zoomMin  = 0.8, zoomMax=50;
    const pinchFactor = 0.005;

    let isDragging=false, lastX=0, lastY=0, lastPinch=null;

    function clamp(v, a, b){ return Math.min(b, Math.max(a, v)); }
    function getRot(){ const r=model.getAttribute('rotation'); return {x:r.x,y:r.y,z:r.z}; }
    function setRot(x,y,z){ model.setAttribute('rotation', `${x} ${y} ${z}`); }
    function getZ(){ return cam.object3D.position.z; }
    function setZ(z){ cam.object3D.position.z = clamp(z, zoomMin, zoomMax); }

    function ready(){
      const canvas = scene.canvas;
      if(!canvas){ console.warn('Canvas nicht verfügbar'); return; }

      // Maus: drehen
      canvas.addEventListener('pointerdown', e=>{
        isDragging=true; lastX=e.clientX; lastY=e.clientY; canvas.setPointerCapture(e.pointerId);
      });
      canvas.addEventListener('pointermove', e=>{
        if(!isDragging) return;
        const dx=e.clientX-lastX, dy=e.clientY-lastY; lastX=e.clientX; lastY=e.clientY;
        const r=getRot(); setRot(clamp(r.x-dy*rotSpeed,-89,89), r.y+dx*rotSpeed, r.z);
      });
      ['pointerup','pointercancel','pointerleave'].forEach(t=>canvas.addEventListener(t,()=>isDragging=false));

      // Maus: zoomen
      canvas.addEventListener('wheel', e=>{ e.preventDefault(); setZ(getZ()+e.deltaY*0.01); }, {passive:false});

      // Touch: 1 Finger drehen, 2 Finger pinch-zoom
      canvas.addEventListener('touchstart', e=>{
        if(e.touches.length===1){ lastX=e.touches[0].clientX; lastY=e.touches[0].clientY; isDragging=true; lastPinch=null; }
        else if(e.touches.length===2){ isDragging=false; lastPinch=dist(e.touches[0], e.touches[1]); }
      }, {passive:false});
      canvas.addEventListener('touchmove', e=>{
        e.preventDefault();
        if(e.touches.length===1 && isDragging){
          const t=e.touches[0], dx=t.clientX-lastX, dy=t.clientY-lastY; lastX=t.clientX; lastY=t.clientY;
          const r=getRot(); setRot(clamp(r.x-dy*rotSpeed,-89,89), r.y+dx*rotSpeed, r.z);
        } else if(e.touches.length===2){
          const d=dist(e.touches[0], e.touches[1]);
          if(lastPinch!=null){ setZ(getZ()+(lastPinch-d)*pinchFactor); }
          lastPinch=d;
        }
      }, {passive:false});
      canvas.addEventListener('touchend', ()=>{ isDragging=false; lastPinch=null; });

      function dist(a,b){ const dx=a.clientX-b.clientX, dy=a.clientY-b.clientY; return Math.hypot(dx,dy); }
    }

    if(scene.hasLoaded) ready(); else scene.addEventListener('loaded', ready);
  </script>
</body>
</html>


