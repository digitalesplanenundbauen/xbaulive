<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex">
  <meta name="color-scheme" content="light" />
  <link rel="stylesheet" href="style.css" />
  <title>Technologiepark & Studierendenzentrum – Live AR-Modus</title>
  
   <!-- =======================
       A-Frame + AR.js
       ======================= -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/three.js/build/ar-threex-location-only.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>
</head>

<body>
  <!-- =======================
       Kopfzeile
       ======================= -->
  <header>
    <div class="header-inner">
      <div class="site-title" aria-label="Projektname">
        Technologiepark <br>
        &amp; Studierendenzentrum
      </div>
      <img class="logo" src="./images/thlogoweiss.svg" alt="Logo" />
    </div>
  </header>

  <!-- =======================
       Hauptbereich: AR-Szene
       ======================= -->
  <main class="main-transparent">

  <!-- GPS-Statusanzeige fixiert am  rechten Bildschirmrand -->
    <div id="gps-status">
      <span class="gps-status-dot"></span>
      <span class="gps-status-text">GPS aktiviert</span>
    </div>

    <div id="content-preview">
      <a-scene
        renderer="logarithmicDepthBuffer: true; alpha: true;"
        embedded
        loading-screen="enabled: false;"
        xr-mode-ui="enabled: false"
        arjs="sourceType: webcam; gpsMinDistance: 2; debugUIEnabled: false;">
        <!-- GLB aus Assets -->
        <a-assets>
          <a-asset-item id="animated-asset" src="./assets/gameobjectohnekellerreduziert.glb"></a-asset-item>
        </a-assets>
        <!-- Welt-Node + Geoposition -->
        <a-entity id="world-yaw" rotation="0 0 0">
          <a-entity gps-entity-place="latitude: 47.867615758; longitude: 12.109218307;">
            <a-entity gltf-model="#animated-asset" scale="0.8 0.8 0.8" position="-20 -4 -10"></a-entity>
          </a-entity>
        </a-entity>
        <!-- Kamera (Simulation an / echtes GPS per Button) -->
        <a-camera id="cam" gps-camera="simulateLatitude: 47.866880722; simulateLongitude: 12.109128178;" rotation-reader></a-camera>
      </a-scene>
    </div>
  </main>

  <!-- =======================
       Fußzeile
       ======================= -->
  <footer>
    <div class="footer-top">
      <button class="live-btn" id="backBtn">Zurück</button>
      <button class="live-btn" id="gpsBtn">GPS ein</button>
    </div>
    <div class="footer-bottom">
      <span class="footer-lab"><strong>Labor für digitales Planen und Bauen</strong> – Raum S 0.36</span>
    </div>
  </footer>

  <!-- =======================
       Interaktion & Funktion
       ======================= -->
  <script>
    // Navigation zurück zur Startseite
    document.getElementById('backBtn')?.addEventListener('click',()=>location.href='index.html');

    // iOS-Orientierungsfix (richtet Modell korrekt zur Gerätelage aus)
    (function(){
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      if(!isIOS) return;
      const world = document.getElementById('world-yaw'); if(!world) return;
      const OFFSETS = { 'portrait-primary':0, 'portrait-secondary':180, 'landscape-primary':90, 'landscape-secondary':-90 };
      const ang = ()=> (screen.orientation && typeof screen.orientation.angle==='number') ? screen.orientation.angle
                    : (typeof window.orientation==='number' ? window.orientation : 0);
      const norm = a=>{ a=((a%360)+360)%360; if(a>180)a-=360; return a; };
      function type(){ const a=norm(ang()); if(a===0)return'portrait-primary'; if(Math.abs(a)===180)return'portrait-secondary'; if(a===90)return'landscape-primary'; if(a===-90)return'landscape-secondary'; return'portrait-primary'; }
      function apply(){ world.setAttribute('rotation',`0 ${ { 'portrait-primary':0,'portrait-secondary':180,'landscape-primary':90,'landscape-secondary':-90 }[type()] } 0`); }
      apply(); window.addEventListener('orientationchange',apply);
    })();

    // GPS-Toggle: Simulation ↔ echtes GPS (minAccuracy)
    const cam = document.getElementById('cam');
    const gpsBtn = document.getElementById('gpsBtn');
    let gpsOn = false;
    const gpsStatus = document.getElementById('gps-status');
    function applyGPS(){
      if(!cam) return;
      if(gpsOn){
        cam.setAttribute('gps-camera','minAccuracy: 50');
        gpsBtn.textContent='GPS aus';
        gpsStatus.style.display = 'flex';
      }
      else{
        cam.setAttribute('gps-camera','simulateLatitude: 47.866880722; simulateLongitude: 12.109128178;');
        gpsBtn.textContent='GPS ein';
        gpsStatus.style.display = 'none';
      }
    }
    gpsBtn?.addEventListener('click',()=>{ gpsOn=!gpsOn; applyGPS(); });
    applyGPS();

    // Abstand in Pixel zwischen Header-Unterkante und GPS-Box
let gpsBoxOffset = 10; // Hier kannst du den Abstand ändern (z.B. 10, 20, 30...)

function positionGpsStatus() {
  const header = document.querySelector('header');
  const gpsStatus = document.getElementById('gps-status');
  if (header && gpsStatus) {
    const rect = header.getBoundingClientRect();
    gpsStatus.style.top = (rect.bottom + gpsBoxOffset) + 'px';
  }
}

// Initial setzen und bei Fenstergröße ändern neu berechnen
window.addEventListener('resize', positionGpsStatus);
window.addEventListener('DOMContentLoaded', positionGpsStatus);

    
  </script>
  <script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
